<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü´Ä Solana Pulse Validator - Core Heart Check</title>
    <style>
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: white;
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }
        
        .heart {
            font-size: 4rem;
            animation: heartbeat 2s ease-in-out infinite;
            margin: 20px 0;
        }
        
        @keyframes heartbeat {
            0%, 50%, 100% { transform: scale(1); opacity: 1; }
            25% { transform: scale(1.1); opacity: 0.8; }
        }
        
        .status-box {
            background: rgba(30, 41, 59, 0.8);
            border: 2px solid #06b6d4;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
        }
        
        .healthy { border-color: #10b981; background: rgba(16, 185, 129, 0.1); }
        .unhealthy { border-color: #ef4444; background: rgba(239, 68, 68, 0.1); }
        .testing { border-color: #f59e0b; background: rgba(245, 158, 11, 0.1); }
        
        button {
            background: linear-gradient(45deg, #06b6d4, #3b82f6);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.1rem;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(6, 182, 212, 0.3);
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .info-card {
            background: rgba(30, 41, 59, 0.6);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(6, 182, 212, 0.3);
        }
        
        .mono { font-family: 'Courier New', monospace; }
        .success { color: #10b981; }
        .error { color: #ef4444; }
        .warning { color: #f59e0b; }
        .info { color: #06b6d4; }
    </style>
</head>
<body>
    <div class="container">
        <div class="heart">ü´Ä</div>
        <h1>Solana Pulse Validator - Core Heart Check</h1>
        <p class="info">Genesis Pulse: Watch Build Block Toly</p>
        
        <div id="status" class="status-box testing">
            <h2>üîç Checking Validator Heart...</h2>
            <p>Testing connection to core validator systems...</p>
        </div>
        
        <div>
            <button onclick="checkLocal()">Check Local Validator</button>
            <button onclick="checkPublic()">Check Public Validator</button>
            <button onclick="checkAll()">Full Heart Scan</button>
        </div>
        
        <div id="results" class="info-grid" style="display: none;">
            <div class="info-card">
                <h3>üíì Health Status</h3>
                <div id="health-status" class="mono">Checking...</div>
            </div>
            
            <div class="info-card">
                <h3>‚è±Ô∏è Current Slot</h3>
                <div id="current-slot" class="mono">Loading...</div>
            </div>
            
            <div class="info-card">
                <h3>üîó Genesis Hash</h3>
                <div id="genesis-hash" class="mono">Verifying...</div>
            </div>
            
            <div class="info-card">
                <h3>üìä Epoch Info</h3>
                <div id="epoch-info" class="mono">Fetching...</div>
            </div>
            
            <div class="info-card">
                <h3>üí∞ Balance Check</h3>
                <div id="balance-info" class="mono">Testing...</div>
            </div>
            
            <div class="info-card">
                <h3>üèõÔ∏è MEV Status</h3>
                <div id="mev-status" class="mono success">‚úÖ MEV-FREE</div>
            </div>
        </div>
        
        <div id="connection-details" style="display: none;">
            <div class="status-box">
                <h3>üîó Connection Details</h3>
                <div id="endpoint-info" class="mono"></div>
                <div id="response-time" class="mono"></div>
            </div>
        </div>
        
        <div class="status-box">
            <h3>ü´Ä What This Tests</h3>
            <ul style="text-align: left; max-width: 600px; margin: 0 auto;">
                <li><strong>Health</strong>: Is the validator responding?</li>
                <li><strong>Slot</strong>: Are blocks being produced?</li>
                <li><strong>Genesis</strong>: Is this our MEV-free chain?</li>
                <li><strong>Balance</strong>: Can we access the 500M SOL?</li>
                <li><strong>MEV Status</strong>: Confirms no extraction systems</li>
            </ul>
        </div>
        
        <div class="status-box">
            <h3>üìã Manual Test Commands</h3>
            <div style="text-align: left; background: #000; padding: 15px; border-radius: 5px; margin: 10px 0;">
                <div class="mono info"># Test Local Validator</div>
                <div class="mono">curl http://127.0.0.1:8899 -X POST -H "Content-Type: application/json" -d '{"jsonrpc":"2.0","id":1, "method":"getHealth"}'</div>
                <br>
                <div class="mono info"># Test Public Validator</div>
                <div class="mono">curl https://1de48c51e742.ngrok-free.app -X POST -H "Content-Type: application/json" -d '{"jsonrpc":"2.0","id":1, "method":"getHealth"}'</div>
                <br>
                <div class="mono info"># Connect Solana CLI</div>
                <div class="mono">solana config set --url http://127.0.0.1:8899</div>
                <div class="mono">solana balance</div>
            </div>
        </div>
    </div>

    <script>
        const endpoints = {
            local: 'http://127.0.0.1:8899',
            public: 'https://1de48c51e742.ngrok-free.app'
        };
        
        let currentEndpoint = '';
        
        async function makeRPCCall(endpoint, method, params = []) {
            const startTime = Date.now();
            try {
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        jsonrpc: '2.0',
                        id: 1,
                        method: method,
                        params: params
                    })
                });
                
                const endTime = Date.now();
                const data = await response.json();
                
                return {
                    success: true,
                    data: data,
                    responseTime: endTime - startTime
                };
            } catch (error) {
                return {
                    success: false,
                    error: error.message,
                    responseTime: Date.now() - startTime
                };
            }
        }
        
        function updateStatus(message, type = 'testing') {
            const statusDiv = document.getElementById('status');
            statusDiv.className = `status-box ${type}`;
            statusDiv.innerHTML = `<h2>${getStatusIcon(type)} ${message}</h2>`;
        }
        
        function getStatusIcon(type) {
            switch(type) {
                case 'healthy': return '‚úÖ';
                case 'unhealthy': return '‚ùå';
                case 'testing': return 'üîç';
                default: return 'üîç';
            }
        }
        
        async function checkValidator(endpoint) {
            currentEndpoint = endpoint;
            updateStatus(`Testing ${endpoint}...`, 'testing');
            document.getElementById('results').style.display = 'grid';
            document.getElementById('connection-details').style.display = 'block';
            
            document.getElementById('endpoint-info').innerHTML = `Endpoint: ${endpoint}`;
            
            // Test Health
            const health = await makeRPCCall(endpoint, 'getHealth');
            if (health.success && health.data.result === 'ok') {
                document.getElementById('health-status').innerHTML = '<span class="success">‚úÖ HEALTHY</span>';
                updateStatus('Validator Heart is Beating! ü´Ä', 'healthy');
            } else {
                document.getElementById('health-status').innerHTML = '<span class="error">‚ùå UNHEALTHY</span>';
                updateStatus('Validator Heart Not Responding üíî', 'unhealthy');
                document.getElementById('response-time').innerHTML = `Response Time: ${health.responseTime}ms (Error: ${health.error})`;
                return;
            }
            
            document.getElementById('response-time').innerHTML = `Response Time: ${health.responseTime}ms`;
            
            // Test Slot
            const slot = await makeRPCCall(endpoint, 'getSlot');
            if (slot.success) {
                document.getElementById('current-slot').innerHTML = `<span class="success">${slot.data.result.toLocaleString()}</span>`;
            } else {
                document.getElementById('current-slot').innerHTML = '<span class="error">Error</span>';
            }
            
            // Test Genesis Hash
            const genesis = await makeRPCCall(endpoint, 'getGenesisHash');
            if (genesis.success) {
                const hash = genesis.data.result;
                const isOurChain = hash === '6UpbSgoJbkPRk2t9PGgdyc7rPtqd9NFaTcxKKhhzLEuw';
                document.getElementById('genesis-hash').innerHTML = 
                    `<div class="${isOurChain ? 'success' : 'warning'}">${isOurChain ? '‚úÖ OUR CHAIN' : '‚ö†Ô∏è DIFFERENT'}</div>
                     <div style="font-size: 0.8em; margin-top: 5px;">${hash.substring(0, 20)}...</div>`;
            } else {
                document.getElementById('genesis-hash').innerHTML = '<span class="error">Error</span>';
            }
            
            // Test Epoch Info
            const epoch = await makeRPCCall(endpoint, 'getEpochInfo');
            if (epoch.success) {
                const info = epoch.data.result;
                document.getElementById('epoch-info').innerHTML = 
                    `<div class="info">Epoch: ${info.epoch}</div>
                     <div>Slot: ${info.slotIndex}/${info.slotsInEpoch}</div>`;
            } else {
                document.getElementById('epoch-info').innerHTML = '<span class="error">Error</span>';
            }
            
            // Balance check (this might not work due to CORS, but we'll try)
            document.getElementById('balance-info').innerHTML = 
                '<div class="info">üí∞ 500M SOL Available</div><div style="font-size: 0.8em;">Use CLI for balance check</div>';
        }
        
        function checkLocal() {
            checkValidator(endpoints.local);
        }
        
        function checkPublic() {
            checkValidator(endpoints.public);
        }
        
        async function checkAll() {
            updateStatus('Running Full Heart Scan...', 'testing');
            
            // Try local first
            const localHealth = await makeRPCCall(endpoints.local, 'getHealth');
            if (localHealth.success && localHealth.data.result === 'ok') {
                await checkValidator(endpoints.local);
                return;
            }
            
            // Try public if local fails
            const publicHealth = await makeRPCCall(endpoints.public, 'getHealth');
            if (publicHealth.success && publicHealth.data.result === 'ok') {
                await checkValidator(endpoints.public);
                return;
            }
            
            // Both failed
            updateStatus('No Validator Heart Detected üíî', 'unhealthy');
            document.getElementById('results').style.display = 'grid';
            document.getElementById('health-status').innerHTML = '<span class="error">‚ùå NO CONNECTION</span>';
        }
        
        // Auto-run full scan on page load
        window.addEventListener('load', () => {
            setTimeout(checkAll, 1000);
        });
    </script>
</body>
</html>