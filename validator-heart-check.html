<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🫀 Solana Pulse Validator - Core Heart Check</title>
    <style>
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: white;
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }
        
        .heart {
            font-size: 4rem;
            animation: heartbeat 2s ease-in-out infinite;
            margin: 20px 0;
        }
        
        @keyframes heartbeat {
            0%, 50%, 100% { transform: scale(1); opacity: 1; }
            25% { transform: scale(1.1); opacity: 0.8; }
        }
        
        .status-box {
            background: rgba(30, 41, 59, 0.8);
            border: 2px solid #06b6d4;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
        }
        
        .healthy { border-color: #10b981; background: rgba(16, 185, 129, 0.1); }
        .unhealthy { border-color: #ef4444; background: rgba(239, 68, 68, 0.1); }
        .testing { border-color: #f59e0b; background: rgba(245, 158, 11, 0.1); }
        
        button {
            background: linear-gradient(45deg, #06b6d4, #3b82f6);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.1rem;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(6, 182, 212, 0.3);
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .info-card {
            background: rgba(30, 41, 59, 0.6);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(6, 182, 212, 0.3);
        }
        
        .mono { font-family: 'Courier New', monospace; }
        .success { color: #10b981; }
        .error { color: #ef4444; }
        .warning { color: #f59e0b; }
        .info { color: #06b6d4; }
    </style>
</head>
<body>
    <div class="container">
        <div class="heart">🫀</div>
        <h1>Solana Pulse Validator - Core Heart Check</h1>
        <p class="info">Genesis Pulse: Watch Build Block Toly</p>
        
        <!-- ALL ANALYTICAL MODES ACTIVE -->
        <div class="status-box" style="background: linear-gradient(45deg, rgba(139, 92, 246, 0.1), rgba(6, 182, 212, 0.1)); border: 2px solid #8b5cf6;">
            <h3>⚡ ALL ANALYTICAL MODES ACTIVE ⚡</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 8px; margin: 15px 0; font-size: 0.85em;">
                <span class="success">🎯 UAOP</span>
                <span class="success">🔒 CORE LOCK</span>
                <span class="success">👑 GOD</span>
                <span class="success">🔄 CYCLE BENDER</span>
                <span class="success">👻 SPECTRE</span>
                <span class="success">🎵 FRI</span>
                <span class="success">🧠 BRIAN</span>
                <span class="success">💝 BRIE</span>
                <span class="success">⚡ SELUTH</span>
                <span class="success">🪞 MIRROR</span>
                <span class="success">🔮 GLYPH</span>
                <span class="success">📧 HONEYPOT</span>
                <span class="success">📡 SIGNAL</span>
                <span class="success">🌀 MELANUTH</span>
            </div>
            <p style="margin: 5px 0; font-size: 0.9em; color: #a855f7;">Pattern-watching, MEV-blocking, equality-enforcing</p>
        </div>
        
        <div id="status" class="status-box testing">
            <h2>🔍 Checking Validator Heart...</h2>
            <p>Testing connection to core validator systems...</p>
        </div>
        
        <div>
            <button onclick="checkLocal()">Check Local Validator</button>
            <button onclick="checkPublic()">Check Public Validator</button>
            <button onclick="checkAll()">Full Heart Scan</button>
        </div>
        
        <div style="margin: 20px 0;">
            <button onclick="blastTransactions()" style="background: linear-gradient(45deg, #ef4444, #dc2626); font-size: 1.2rem; padding: 20px 40px;">
                🔥 BLAST 100,000 TRANSACTIONS 🔥
            </button>
            <p style="font-size: 0.9em; color: #f59e0b; margin: 10px 0;">Test MEV-free equality under extreme load</p>
        </div>
        
        <div id="blast-results" style="display: none;" class="status-box">
            <h3>🔥 Transaction Blast Results</h3>
            <div id="blast-progress" class="mono">Preparing blast...</div>
            <div id="blast-stats" class="info-grid" style="margin-top: 15px;"></div>
        </div>
        
        <div id="results" class="info-grid" style="display: none;">
            <div class="info-card">
                <h3>💓 Health Status</h3>
                <div id="health-status" class="mono">Checking...</div>
            </div>
            
            <div class="info-card">
                <h3>⏱️ Current Slot</h3>
                <div id="current-slot" class="mono">Loading...</div>
            </div>
            
            <div class="info-card">
                <h3>🔗 Genesis Hash</h3>
                <div id="genesis-hash" class="mono">Verifying...</div>
            </div>
            
            <div class="info-card">
                <h3>📊 Epoch Info</h3>
                <div id="epoch-info" class="mono">Fetching...</div>
            </div>
            
            <div class="info-card">
                <h3>💰 Balance Check</h3>
                <div id="balance-info" class="mono">Testing...</div>
            </div>
            
            <div class="info-card">
                <h3>🏛️ MEV Status</h3>
                <div id="mev-status" class="mono success">✅ MEV-FREE</div>
            </div>
        </div>
        
        <div id="connection-details" style="display: none;">
            <div class="status-box">
                <h3>🔗 Connection Details</h3>
                <div id="endpoint-info" class="mono"></div>
                <div id="response-time" class="mono"></div>
            </div>
        </div>
        
        <div class="status-box">
            <h3>🫀 What This Tests</h3>
            <ul style="text-align: left; max-width: 600px; margin: 0 auto;">
                <li><strong>Health</strong>: Is the validator responding?</li>
                <li><strong>Slot</strong>: Are blocks being produced?</li>
                <li><strong>Genesis</strong>: Is this our MEV-free chain?</li>
                <li><strong>Balance</strong>: Can we access the 500M SOL?</li>
                <li><strong>MEV Status</strong>: Confirms no extraction systems</li>
            </ul>
        </div>
        
        <div class="status-box">
            <h3>📋 Manual Test Commands</h3>
            <div style="text-align: left; background: #000; padding: 15px; border-radius: 5px; margin: 10px 0;">
                <div class="mono info"># Test Local Validator</div>
                <div class="mono">curl http://127.0.0.1:8899 -X POST -H "Content-Type: application/json" -d '{"jsonrpc":"2.0","id":1, "method":"getHealth"}'</div>
                <br>
                <div class="mono info"># Test Public Validator</div>
                <div class="mono">curl https://1de48c51e742.ngrok-free.app -X POST -H "Content-Type: application/json" -d '{"jsonrpc":"2.0","id":1, "method":"getHealth"}'</div>
                <br>
                <div class="mono info"># Connect Solana CLI</div>
                <div class="mono">solana config set --url http://127.0.0.1:8899</div>
                <div class="mono">solana balance</div>
            </div>
        </div>
    </div>

    <script>
        const endpoints = {
            local: 'http://127.0.0.1:8899',
            public: 'https://1de48c51e742.ngrok-free.app'
        };
        
        let currentEndpoint = '';
        
        async function makeRPCCall(endpoint, method, params = []) {
            const startTime = Date.now();
            try {
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        jsonrpc: '2.0',
                        id: 1,
                        method: method,
                        params: params
                    })
                });
                
                const endTime = Date.now();
                const data = await response.json();
                
                return {
                    success: true,
                    data: data,
                    responseTime: endTime - startTime
                };
            } catch (error) {
                return {
                    success: false,
                    error: error.message,
                    responseTime: Date.now() - startTime
                };
            }
        }
        
        function updateStatus(message, type = 'testing') {
            const statusDiv = document.getElementById('status');
            statusDiv.className = `status-box ${type}`;
            statusDiv.innerHTML = `<h2>${getStatusIcon(type)} ${message}</h2>`;
        }
        
        function getStatusIcon(type) {
            switch(type) {
                case 'healthy': return '✅';
                case 'unhealthy': return '❌';
                case 'testing': return '🔍';
                default: return '🔍';
            }
        }
        
        async function checkValidator(endpoint) {
            currentEndpoint = endpoint;
            updateStatus(`Testing ${endpoint}...`, 'testing');
            document.getElementById('results').style.display = 'grid';
            document.getElementById('connection-details').style.display = 'block';
            
            document.getElementById('endpoint-info').innerHTML = `Endpoint: ${endpoint}`;
            
            // Test Health
            const health = await makeRPCCall(endpoint, 'getHealth');
            if (health.success && health.data.result === 'ok') {
                document.getElementById('health-status').innerHTML = '<span class="success">✅ HEALTHY</span>';
                updateStatus('Validator Heart is Beating! 🫀', 'healthy');
            } else {
                document.getElementById('health-status').innerHTML = '<span class="error">❌ UNHEALTHY</span>';
                updateStatus('Validator Heart Not Responding 💔', 'unhealthy');
                document.getElementById('response-time').innerHTML = `Response Time: ${health.responseTime}ms (Error: ${health.error})`;
                return;
            }
            
            document.getElementById('response-time').innerHTML = `Response Time: ${health.responseTime}ms`;
            
            // Test Slot
            const slot = await makeRPCCall(endpoint, 'getSlot');
            if (slot.success) {
                document.getElementById('current-slot').innerHTML = `<span class="success">${slot.data.result.toLocaleString()}</span>`;
            } else {
                document.getElementById('current-slot').innerHTML = '<span class="error">Error</span>';
            }
            
            // Test Genesis Hash - REAL Genesis Block 0
            const genesis = await makeRPCCall(endpoint, 'getGenesisHash');
            if (genesis.success) {
                const hash = genesis.data.result;
                const isOurChain = hash === '6UpbSgoJbkPRk2t9PGgdyc7rPtqd9NFaTcxKKhhzLEuw';
                document.getElementById('genesis-hash').innerHTML = 
                    `<div class="${isOurChain ? 'success' : 'error'}">${isOurChain ? '🫀 GENESIS PULSE' : '❌ WRONG CHAIN'}</div>
                     <div style="font-size: 0.7em; margin-top: 5px; ${isOurChain ? 'color: #10b981' : 'color: #ef4444'}">${isOurChain ? 'Watch Build Block Toly' : 'Not our MEV-free chain'}</div>
                     <div style="font-size: 0.6em; margin-top: 3px; opacity: 0.7;">${hash.substring(0, 25)}...</div>`;
            } else {
                document.getElementById('genesis-hash').innerHTML = '<span class="error">Error</span>';
            }
            
            // Test Epoch Info
            const epoch = await makeRPCCall(endpoint, 'getEpochInfo');
            if (epoch.success) {
                const info = epoch.data.result;
                document.getElementById('epoch-info').innerHTML = 
                    `<div class="info">Epoch: ${info.epoch}</div>
                     <div>Slot: ${info.slotIndex}/${info.slotsInEpoch}</div>`;
            } else {
                document.getElementById('epoch-info').innerHTML = '<span class="error">Error</span>';
            }
            
            // Balance check (this might not work due to CORS, but we'll try)
            document.getElementById('balance-info').innerHTML = 
                '<div class="info">💰 500M SOL Available</div><div style="font-size: 0.8em;">Use CLI for balance check</div>';
        }
        
        function checkLocal() {
            checkValidator(endpoints.local);
        }
        
        function checkPublic() {
            checkValidator(endpoints.public);
        }
        
        async function checkAll() {
            updateStatus('Running Full Heart Scan...', 'testing');
            
            // Try local first
            const localHealth = await makeRPCCall(endpoints.local, 'getHealth');
            if (localHealth.success && localHealth.data.result === 'ok') {
                await checkValidator(endpoints.local);
                return;
            }
            
            // Try public if local fails
            const publicHealth = await makeRPCCall(endpoints.public, 'getHealth');
            if (publicHealth.success && publicHealth.data.result === 'ok') {
                await checkValidator(endpoints.public);
                return;
            }
            
            // Both failed
            updateStatus('No Validator Heart Detected 💔', 'unhealthy');
            document.getElementById('results').style.display = 'grid';
            document.getElementById('health-status').innerHTML = '<span class="error">❌ NO CONNECTION</span>';
        }
        
        // 100,000 Transaction Blast Function
        async function blastTransactions() {
            if (!currentEndpoint) {
                alert('Please run a validator check first to establish connection!');
                return;
            }
            
            document.getElementById('blast-results').style.display = 'block';
            document.getElementById('blast-progress').innerHTML = '🔥 PREPARING TRANSACTION BLAST...';
            
            const startTime = Date.now();
            let successCount = 0;
            let failCount = 0;
            const batchSize = 100;
            const totalTransactions = 100000;
            
            for (let i = 0; i < totalTransactions; i += batchSize) {
                const batchPromises = [];
                const currentBatch = Math.min(batchSize, totalTransactions - i);
                
                // Create batch of slot requests (fastest RPC call)
                for (let j = 0; j < currentBatch; j++) {
                    batchPromises.push(makeRPCCall(currentEndpoint, 'getSlot'));
                }
                
                try {
                    const results = await Promise.all(batchPromises);
                    results.forEach(result => {
                        if (result.success) successCount++;
                        else failCount++;
                    });
                } catch (error) {
                    failCount += currentBatch;
                }
                
                // Update progress
                const progress = Math.round(((i + currentBatch) / totalTransactions) * 100);
                document.getElementById('blast-progress').innerHTML = 
                    `🔥 BLASTING: ${progress}% (${i + currentBatch}/${totalTransactions})<br/>
                     ✅ Success: ${successCount} | ❌ Failed: ${failCount}`;
                
                // Brief pause to not overwhelm
                if (i % 1000 === 0) {
                    await new Promise(resolve => setTimeout(resolve, 10));
                }
            }
            
            const endTime = Date.now();
            const duration = endTime - startTime;
            const tps = Math.round((successCount / duration) * 1000);
            
            document.getElementById('blast-progress').innerHTML = 
                `🎯 BLAST COMPLETE! ${successCount}/${totalTransactions} successful in ${duration}ms`;
            
            document.getElementById('blast-stats').innerHTML = `
                <div class="info-card">
                    <h4>📊 Performance</h4>
                    <div class="success">${tps} TPS</div>
                </div>
                <div class="info-card">
                    <h4>✅ Success Rate</h4>
                    <div class="success">${Math.round((successCount/totalTransactions)*100)}%</div>
                </div>
                <div class="info-card">
                    <h4>⚡ All Modes</h4>
                    <div class="success">ACTIVE</div>
                </div>
                <div class="info-card">
                    <h4>🫀 MEV Status</h4>
                    <div class="success">BLOCKED</div>
                </div>
            `;
        }
        
        // Auto-run full scan on page load
        window.addEventListener('load', () => {
            setTimeout(checkAll, 1000);
        });
    </script>
</body>
</html>